<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
<title>Stary Bird</title>
<style>
  html, body { margin:0; padding:0; height:100%; background:#07090d; color:#eaf2ff; font:14px/1.5 system-ui,sans-serif; }
  body { overflow:hidden; overscroll-behavior:none; touch-action:none; }
  .stage { position:fixed; inset:0; width:100vw; height:100svh; }
  #game  { position:absolute; left:0; top:0; width:100%; height:100%; display:block;
           background:linear-gradient(180deg,#0a1120,#0a0f17 65%, #090d14); }
  .hud{ position:absolute; right:18px; top:18px; background:rgba(255,255,255,.08);
        padding:6px 10px; border-radius:10px; font-weight:800; letter-spacing:.06em; z-index:3; }
  .controls{ position:absolute; left:18px; top:18px; opacity:.6; font-weight:700; color:#c9d8ff; z-index:2; }
  .center{ position:absolute; inset:0; display:grid; place-items:center;
           pointer-events:none; font-weight:900; letter-spacing:.08em;
           color:#9fb7ff99; text-align:center; padding:0 10px; z-index:1; }
  .charbtn{ position:absolute; left:18px; bottom:18px; z-index:4; padding:10px 14px; border-radius:12px;
            border:1px solid #2a3a5a; background:linear-gradient(180deg,#111827,#0d1421);
            color:#eaf2ff; font-weight:800; letter-spacing:.05em;
            box-shadow:0 8px 28px rgba(0,0,0,.45),inset 0 1px 0 rgba(255,255,255,.06);}
</style>
</head>
<body>
  <div class="stage">
    <canvas id="game"></canvas>
    <div class="hud" id="hud">0 • HI 0</div>
    <div class="controls">SPACE / TAP</div>
    <div class="center" id="msg">TAP / SPACE TO START</div>
    <button class="charbtn" id="charBtn" type="button">Change Character</button>
  </div>
<script>
(() => {
  // --- Setup
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const hud = document.getElementById('hud');
  const msg = document.getElementById('msg');
  const charBtn = document.getElementById('charBtn');

  // --- Responsive sizing
  function sizeToViewport() {
    const w = window.innerWidth, h = window.innerHeight;
    canvas.width = w; canvas.height = h;
    canvas.style.width = w+'px'; canvas.style.height = h+'px';
  }
  window.addEventListener('resize', sizeToViewport); sizeToViewport();

  // --- Skins (no external assets)
  const skins = [
    { id:'diamond', name:'Diamond', draw: (ctx,sz) => {
      ctx.fillStyle = "#9fc2ff";
      ctx.beginPath();
      ctx.moveTo(0,-sz*0.45); ctx.lineTo(sz*0.45,0); ctx.lineTo(0,sz*0.45); ctx.lineTo(-sz*0.45,0); ctx.closePath();
      ctx.fill();
    }},
    { id:'circle', name:'Circle', draw: (ctx,sz) => {
      ctx.fillStyle = "#6aa0ff";
      ctx.beginPath();
      ctx.arc(0,0, sz*0.45, 0, Math.PI*2); ctx.fill();
    }},
    { id:'star', name:'Star', draw: (ctx,sz) => {
      ctx.fillStyle = "#ffd54a";
      ctx.save();
      ctx.rotate(-Math.PI/2);
      for(let i=0;i<5;i++){
        ctx.lineTo(Math.cos(i * 2*Math.PI/5)*sz*0.45, Math.sin(i * 2*Math.PI/5)*sz*0.45);
        ctx.lineTo(Math.cos((i+0.5) * 2*Math.PI/5)*sz*0.18, Math.sin((i+0.5) * 2*Math.PI/5)*sz*0.18);
      }
      ctx.closePath(); ctx.fill();
      ctx.restore();
    }}
  ];
  let skinIndex = Number(localStorage.getItem('stary_bird_skin_index'))||0;
  function nextSkin() {
    skinIndex = (skinIndex+1)%skins.length;
    localStorage.setItem('stary_bird_skin_index', skinIndex);
    charBtn.textContent = `Change Character (${skins[skinIndex].name})`;
  }
  charBtn.onclick = nextSkin;
  charBtn.textContent = `Change Character (${skins[skinIndex].name})`;

  // --- Game state
  const state = {
    playing:false, dead:false, score:0, hi:Number(localStorage.getItem('stary_bird_hi')||0),
    pipes:[], v:0, y:canvas.height/2, x:canvas.width/3, t:0, gap:150, speed:3.7, spawn:0, respawn:0,
  };

  // --- Controls
  let hold = false;
  function startIfNeeded() {
    if (!state.playing && !state.dead) start();
    else if (state.dead && state.respawn<=0) restart();
  }
  window.addEventListener('keydown', e => {
    if (['Space','ArrowUp','KeyW','Enter'].includes(e.code)) {
      e.preventDefault(); hold = true; startIfNeeded();
    }
  });
  window.addEventListener('keyup', e => {
    if (['Space','ArrowUp','KeyW','Enter'].includes(e.code)) {
      e.preventDefault(); hold = false;
      if (state.dead && state.respawn<=0) restart();
    }
  });
  canvas.addEventListener('touchstart', e=>{ e.preventDefault(); hold=true; startIfNeeded(); },{passive:false});
  canvas.addEventListener('touchend',   e=>{ e.preventDefault(); hold=false; if(state.dead&&state.respawn<=0)restart(); },{passive:false});

  // --- Game functions
  function reset() {
    state.playing=false; state.dead=false; state.score=0; state.pipes=[];
    state.v=0; state.gap=150; state.speed=3.7; state.y=canvas.height/2; state.x=canvas.width/3; state.t=0; state.spawn=30; state.respawn=0;
    msg.textContent = 'TAP / SPACE TO START'; msg.style.display=''; charBtn.style.display='';
    hud.textContent = `0 • HI ${state.hi}`;
  }
  function start() {
    if(state.dead) return;
    state.playing=true; msg.style.display='none'; charBtn.style.display='none';
  }
  function restart() { reset(); start(); }

  // --- Pipe functions
  function addPipe() {
    const margin = 60;
    const prev = (state.pipes.length ? state.pipes[state.pipes.length-1].gy : canvas.height/2);
    const gapY = Math.max(margin+state.gap/2, Math.min(canvas.height-margin-state.gap/2, prev + (Math.random()-0.5)*90 ));
    state.pipes.push({ x:canvas.width+60, w:60, gy:gapY });
    state.spawn = 110 + Math.random()*60;
  }

  // --- Collision
  function hitPipe(pipe) {
    const half = state.gap/2;
    if (state.x+30 > pipe.x && state.x-30 < pipe.x+pipe.w) {
      if (state.y-30 < pipe.gy-half || state.y+30 > pipe.gy+half) return true;
    }
    return false;
  }
  function hitBounds() { return (state.y < 0) || (state.y > canvas.height); }

  // --- Loop
  function loop(ts) {
    const dt = 16.67; // fixed for simplicity
    state.t += dt;
    // Death pause (show explosion for a bit)
    if(state.dead && state.respawn>0) {
      state.respawn -= dt;
      if(state.respawn<=0) reset();
      draw();
      requestAnimationFrame(loop); return;
    }
    // Main game logic
    if(state.playing && !state.dead) {
      if(hold) state.v -= 0.6;
      state.v += 0.34;
      if(state.v > 9) state.v = 9;
      if(state.v < -9) state.v = -9;
      state.y += state.v;
      // Pipes
      state.spawn -= 1;
      if(state.spawn<=0) addPipe();
      state.pipes.forEach(pipe=>pipe.x -= state.speed);
      // Remove old
      while(state.pipes.length && state.pipes[0].x+state.pipes[0].w<-40) state.pipes.shift();
      // Score
      state.pipes.forEach(pipe=>{
        if(!pipe.passed && state.x > pipe.x+pipe.w) { pipe.passed=true; state.score++; }
      });
      // Collisions
      for(const pipe of state.pipes) if(hitPipe(pipe)) die();
      if(!state.dead && hitBounds()) die();
      // Difficulty
      state.speed = Math.min(8.2, state.speed+0.0004*dt);
      state.gap   = Math.max(100, state.gap-0.002*dt);
    }
    draw();
    requestAnimationFrame(loop);
  }

  // --- Die
  function die() {
    if(state.dead) return;
    state.dead = true; state.playing = false;
    state.hi = Math.max(state.hi, state.score);
    localStorage.setItem('stary_bird_hi', state.hi);
    state.respawn = 800;
    charBtn.style.display='none';
    msg.style.display='none';
  }

  // --- Draw
  function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    // Starfield
    ctx.globalAlpha = 0.12;
    for(let i=0;i<60;i++){
      ctx.fillStyle="#bcd1ff";
      ctx.fillRect((i*110-(state.t*0.035)%110),30+(i*47)%(canvas.height-60),2,2);
    }
    ctx.globalAlpha = 1;
    // Pipes
    ctx.fillStyle="#12324f";
    state.pipes.forEach(pipe=>{
      const half=state.gap/2, x=pipe.x,w=pipe.w, yTop=0,hTop=pipe.gy-half, yBot=pipe.gy+half,hBot=canvas.height-(pipe.gy+half);
      if(hTop>0) ctx.fillRect(x,yTop,w,hTop);
      if(hBot>0) ctx.fillRect(x,yBot,w,hBot);
    });
    // Player
    ctx.save();
    ctx.translate(state.x,state.y);
    ctx.rotate(state.v/22);
    const sz=54;
    // Glow
    ctx.globalAlpha=0.26; ctx.filter='blur(4px)';
    ctx.beginPath(); ctx.ellipse(0, 0, sz*0.45, sz*0.45, 0, 0, Math.PI*2); ctx.fillStyle='#fff'; ctx.fill();
    ctx.globalAlpha=1; ctx.filter='none';
    // Character
    ctx.beginPath();
    skins[skinIndex].draw(ctx, sz);
    ctx.restore();
    // HUD
    hud.textContent = `${state.score} • HI ${state.hi}`;
  }

  // --- Boot
  reset();
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
